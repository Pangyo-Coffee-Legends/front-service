<!DOCTYPE html>
<html lang="ko" layout:decorate="@{/layout/index/layout.html}" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <title>오피스 제어 대시보드</title>
    <!-- Pretendard 폰트 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
    <!-- ✅ 외부 CSS 링크 -->
    <link rel="stylesheet" href="/css/comfort-dashboard/comfort-dashboard.css">
</head>
<body oncontextmenu="return false">
<div layout:fragment="content">
    <h2 style="text-align: center; margin-top: 30px; font-size: 24px;">오피스 제어 대시보드</h2>
    <div class="dashboard-container">
        <!-- 왼쪽 패널 -->
        <div id="popup-panel" class="popup-panel">
            <!-- 장소 등록 -->
            <div class="collapsible">
                <div class="collapsible-header">장소 등록</div>
                <div class="collapsible-body">
                    <form id="place-form" enctype="multipart/form-data">
                        <div class="form-group">
                            <label for="placeName">장소명</label>
                            <input type="text" id="placeName" name="placeName" placeholder="예: 회의실 A" required>
                        </div>
                        <div class="form-group">
                            <label for="placeImage">도면 이미지</label>
                            <input type="file" id="placeImage" name="file" accept="image/*" required>
                        </div>
                        <button type="submit">등록하기</button>
                    </form>
                </div>
            </div>

            <!-- 장소 수정 -->
            <div class="collapsible">
                <div class="collapsible-header">장소 수정</div>
                <div class="collapsible-body">
                    <form id="place-edit-form" enctype="multipart/form-data">
                        <input type="hidden" name="placeNo" value="14">
                        <div class="form-group">
                            <label for="editPlaceName">수정할 장소명</label>
                            <input type="text" id="editPlaceName" name="placeName" value="수정 할 장소명" required>
                        </div>
                        <div class="form-group">
                            <label for="editPlaceFile">도면 이미지 변경 (선택)</label>
                            <input type="file" id="editPlaceFile" name="file" accept="image/*">
                        </div>
                        <div class="form-actions">
                            <button type="submit">수정하기</button>
                            <button type="button" id="delete-place-btn">장소 삭제</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- 환경 정보 카드 -->
            <div id="env-info-card" class="card-box">
                <h5 id="popup-title">공간명</h5>
                <div class="data-row"><span>내부 온도</span><span id="env-temp">-</span></div>
                <div class="data-row"><span>내부 습도</span><span id="env-humi">-</span></div>
                <div class="data-row"><span>CO₂</span><span id="env-co2">-</span></div>
                <div class="data-row"><span>쾌적도</span><span id="env-index">-</span></div>
                <div class="data-row"><span>상태</span><span id="env-comment">-</span></div>
            </div>

            <!-- 날씨 정보 카드 -->
            <div class="card-box">
                <h5>외부 날씨</h5>
                <div class="data-row"><span>현재 위치</span><span id="weather-location-label">-</span></div>
                <div class="data-row"><span>외부 기온</span><span id="weather-temp">-</span></div>
                <div class="data-row"><span>외부 습도</span><span id="weather-humi">-</span></div>
                <div class="data-row"><span>풍속</span><span id="weather-wind">-</span></div>
                <div class="data-row"><span>상태</span><span id="weather-desc">-</span></div>
            </div>

            <!-- 장비 상태 -->
            <div id="device-status" class="card-box">
                <h5>작동 상태</h5>
            </div>
        </div>

        <!-- 도면 영역 -->
        <div id="floor-wrapper">
            <select id="place-select"></select>
            <img id="floor-image" src="" alt="오피스 도면" draggable="false">

            <!-- 위치별 인포박스 -->
            <div class="info-box" style="top: 55%; left: 17%;" onclick="showPopup('deptA', this)">
                <div class="label">사무실 A</div>
                <hr class="divider">
                <div class="grade" id="grade-deptA">-</div>
            </div>

            <div class="info-box" style="top: 18%; left: 17%;" onclick="showPopup('deptB', this)">
                <div class="label">사무실 B</div>
                <hr class="divider">
                <div class="grade" id="grade-deptB">-</div>
            </div>

            <div class="info-box" style="top: 18%; left: 80%;" onclick="showPopup('meetingA', this)">
                <div class="label">회의실 A</div>
                <hr class="divider">
                <div class="grade" id="grade-meetingA">-</div>
            </div>

            <div class="info-box" style="top: 55%; left: 57%;" onclick="showPopup('meetingB', this)">
                <div class="label">회의실 B</div>
                <hr class="divider">
                <div class="grade" id="grade-meetingB">-</div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="/js/comfort-dashboard.js" defer></script>
    <script src="/js/place/place-selector.js" defer></script>
    <script>
        // Collapsible toggle
        document.querySelectorAll('.collapsible-header').forEach(header => {
            header.addEventListener('click', () => {
                const wrapper = header.closest('.collapsible');
                wrapper.classList.toggle('open');
            });
        });
    </script>
</div>
</body>
</html>
